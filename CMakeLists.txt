cmake_minimum_required(VERSION 3.14.0)
project(test VERSION 0.1.0)
include(cmake/firmware_download.cmake)
set(CMAKE_INSTALL_PREFIX "")
set(SUPPORTED_TARGETS "raspi" "raspi64" "pbpro" "rockpro64")
set(TARGET "raspi" CACHE STRING "One of target machines: ${SUPPORTED_TARGETS}")

find_program(DTC dtc)

if (${TARGET} IN_LIST SUPPORTED_TARGETS)
    message("-- Selected target machine: ${TARGET}")
    if(${TARGET} STREQUAL "raspi64" OR ${TARGET} STREQUAL "raspi")
        download_raspi_firmware()
        install(DIRECTORY ${CMAKE_BINARY_DIR}/firmware/ DESTINATION .)
    elseif(${TARGET} STREQUAL "pbpro")
        install(FILES ${CMAKE_SOURCE_DIR}/blobs/rk3399-pinebookpro.dtb DESTINATION .)
    endif()
else()
    message(FATAL_ERROR "Wrong target machine specified: ${TARGET}")
endif()
